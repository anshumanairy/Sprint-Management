{% extends 'home.html' %}
{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.8/js/select2.js" integrity="sha256-ZIgVXws0JSyxy1OmqGeFYUsfoNr22H2o4dMlFBrKLUU=" crossorigin="anonymous"></script>

<link rel="stylesheet" href="/static/css/progress.css">
  <script>
    $(document).ready(function(){
      $('#tab2').tablesorter();
    });
  </script>

  <body id="re">
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color:black; font-size:12px;" id="mainNav">
      <div class="container">
        <a class="navbar-brand">Sprint Progress</a>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <div id="hid">
              <div id="hid3">
                <form class="post-form" method='POST' id="h">
                  {% csrf_token %}
                  <!-- onchange="myFunction(this.value)" -->
                    <select class="js-example-basic-single" name="select_project">
                        <option selected="true" disabled>{{ nx }}</option>
                      {% for n1 in n0 %}
                        <option>{{ n1.name }}</option>
                      {% endfor %}
                    </select>
                </form>

                <script>
                  $(document).ready(function() {
                      var frm = $('#h');
                      frm.on('change',function (e) {
                        e.preventDefault();
                          $.ajax({
                              type: frm.attr('method'),
                              data: frm.serialize(),
                              success: function(data) {
                                $("#re").html(data);
                              },
                          });
                      });
                    });
                </script>
              </div>
              <div id="hid1">
                <form class="post-form" method='POST' id="f5">
                  {% csrf_token %}
                    <select class="js-example-basic-single" name="select_sprint">
                      <option selected="true" disabled>{{ nx1 }}</option>
                      {% for product in data1 %}
                      <option> {{ product.name }}</option>
                        {% endfor %}
                    </select>
                </form>

                <script>
                  $(document).ready(function() {
                      var frm = $('#f5');
                      frm.on('change',function (e) {
                        e.preventDefault();
                          $.ajax({
                              type: frm.attr('method'),
                              data: frm.serialize(),
                              success: function(data) {
                                $("#re").html(data);
                              },
                          });
                      });
                    });
                </script>
              </div>
            </div>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="{% url 'product' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="{% url 'view_story' %}">Stories</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="{% url 'qaprg' %}">Progress</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="{% url 'bandwidth' %}">Bandwidth</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="{% url 'tasks' %}l">Sprint Report</a>
            </li>
            <div class="btn-group">
                <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" style="background-color:black;"></button>
                <div class="dropdown-menu dropdown-menu-right">
                    <a href="{% url 'profile' %}" class="dropdown-item">Profile</a>
                    <a href="{% url 'logout' %}" class="dropdown-item">Logout</a>
                </div>
            </div>
          </ul>
        </div>
      </div>
    </nav>

    <div class="content" style="padding-top:7%;">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <div class="table100 ver3">
                <table class="table" id="tab2" data-vertable="ver1" style="text-align:center;">
                  <thead class=" text-primary">
                    <!-- <th>Check</th> -->
                    <th>Name</th>
                    <th>Jira ID</th>
                    <th>Overall Status</th>
                    <th>Estimate</th>
                    <th>Completed/Left</th>
                    <th>Change Left</th>
                    <th>Date</th>
                    <th>Estimate/Day</th>
                    <th>Progress</th>
                    <th>Check</th>
                  </thead>
                  <tbody>
                    {% for i in data %}
                    <tr class="row100 head">
                      <td style="color:black;"><b>{{ i.name }}</b></td>
                      <td colspan='8'></td>
                    </tr>
                    {% for j in list1 %}
                      {% if forloop.counter == forloop.parentloop.counter %}
                        {% for k in j %}
                    <tr class="row100 head">
                      <td><a href="/blog" target="_blank">{{ k.0 }}</a></td>
                      <td><a href="/blog" target="_blank">{{ k.1 }}</a></td>
                      <form method="GET">
                      <td>
                        <select class="js-example-basic-single" style="width:60%;" name="sel">
                          <option selected="true" disabled>{{ k.3 }}</option>
                          <option>Live</option>
                          <option>In Progress</option>
                          <option>HTML Done</option>
                          <option>PHP Done</option>
                          <option>API Done</option>
                          <option>QA</option>
                          <option>Pending Deployment</option>
                          <option>Blocked</option>
                          <option>BLocked on API</option>
                          <option>Blocked on HTML</option>
                          <option>Blocked on Mock</option>
                          <option>Blocked on Spec</option>
                          <option>Not Needed</option>
                          <option>Next Sprint</option>
                          <option>Duplicate</option>
                          <option>CR</option>
                          <option>Complete</option>
                        </select>
                        <input type="hidden" name="jid" value="{{ k.1 }}">
                        <input type="hidden" name="name1" value="{{ i.name }}">
                        <input class="btn example_c" type="submit" name="as" value="Assign">
                      </td>
                      </form>

                      <td>{{ k.2 }}</td>
                      <td>{{ k.6 }} / {{k.7}}</td>
                      <form method="GET" id="a{{k.1}}">
                      <td>
                        <input type="number" name="left" min=0 value="{{k.8}}" step="0.5" style="width:70px;">
                      </td>
                      <td>
                        <input type="text" name="startdate" class="datepicker" placeholder="Work Date" style="width:140px;">
                      </td>
                      <td>
                        <select class="js-example-basic-single" style="width:100%;" name="fraction">
                          <option>Quarter Day</option>
                          <option>Half Day</option>
                          <option>Three Quarters Day</option>
                          <option>Full Day</option>
                        </select>
                      </td>
                      <td style="width:250px;">
                        <select class="js-example-basic-single" style="width:50%;" name="prg">
                          <option>Dev</option>
                          <option>CR Fix</option>
                          <option>QA Support</option>
                          <option>Release Support</option>
                        </select>
                        <input type="hidden" name="j1" value="{{ k.1 }}">
                        <input type="hidden" name="name2" value="{{ i.name }}">
                        <input class="btn example_c" type="submit" name='as1' value="Submit">
                      </td>
                      <td><input type="text" placeholder="Check Status" class="datepicker1" id="datepicker{{k.5}}" style="width:140px;"></td>
                      <script>
                        $(document).ready(function() {
                            var nDates = {};
                            var data  = JSON.parse('{{ d1|escapejs }}');
                            var stat = JSON.parse('{{ d2|escapejs }}');
                            var jid = JSON.parse('{{ d3|escapejs }}');
                            var arr1=[];
                            var arr3=[];
                            var j_id=[];
                            var dev_name=[];

                            for(i in data){
                              if(i=="{{i.name}}"){
                                for(j in data[i]){
                                  if(j=="{{k.5}}"){
                                    for(k in data[i][j]){
                                      if(data[i][j].hasOwnProperty(k)){
                                          arr1.push(k);
                                      }
                                    }
                                    dev_name.push(i);
                                  }
                                }
                              }
                            }
                            // console.log(arr1);

                            for(i in stat){
                              if(i=="{{i.name}}"){
                                for(j in stat[i]){
                                  if(j=="{{k.5}}"){
                                    for(k in stat[i][j]){
                                      if(stat[i][j].hasOwnProperty(k)){
                                        arr3.push(stat[i][j][k]);
                                      }
                                    }
                                  }
                                }
                              }
                            }
                            // console.log(arr3);

                          for(i in jid){
                            if(i=="{{i.name}}"){
                              for(j in jid[i]){
                                if(j=="{{k.5}}"){
                                  j_id.push(jid[i][j]);
                                }
                              }
                            }
                          }
                          // console.log(j_id);

                          for(var i =0 ;i<arr1.length;i++){
                              var day = 1000*60*60*24;
                              date1 = new Date(arr1[i]);
                                 var xx = date1.getTime();
                                 var yy = new Date(xx);
                                 z=(yy.getFullYear()+"/"+(yy.getMonth()+1)+"/"+yy.getDate());
                                 if(yy.getDay()!=0 && yy.getDay()!=6){
                                     if(arr3[i]=='Dev'){
                                       nDates[new Date(z)] = 1;
                                     }
                                     if(arr3[i]=='CR Fix'){
                                       nDates[new Date(z)] = 2;
                                     }
                                     if(arr3[i]=='QA Support'){
                                       nDates[new Date(z)] = 3;
                                     }
                                     if(arr3[i]=='Release Support'){
                                       nDates[new Date(z)] = 4;
                                     }
                              }
                          }


                          $("#datepicker{{k.5}}").datepicker({
                              dateFormat: 'yy-mm-dd',
                              minDate: new Date({{a}},{{b}}-1,{{c}}),
                              maxDate: new Date({{d}},{{e}}-1,{{f}}),
                              beforeShowDay: function (date) {
                                  var dev1 = nDates[date];
                                  var color="";
                                  if (dev1) {
                                      if(dev1==1)
                                        color='dev';
                                      if(dev1==2)
                                        color='cr';
                                      if(dev1==3)
                                        color='qa';
                                      if(dev1==4)
                                        color='rel';
                                      return [true, color, 'Tooltip text'];
                                  }
                                  else {
                                      return [false, '', ''];
                                  }
                              }
                          }).attr('readonly','readonly');
                      });
                    </script>
                    </form>
                    </tr>
                        {% endfor %}
                      {% endif %}
                    {% endfor %}
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

<script>
  $( function() {
    $( ".datepicker" ).datepicker({
      dateFormat: 'yy-mm-dd',
      minDate: new Date({{a}},{{b}}-1,{{c}}),
      maxDate: new Date({{d}},{{e}}-1,{{f}}),
      beforeShowDay: $.datepicker.noWeekends
    })
  });
</script>

<div class="col-md-12">
  <div class='box green'></div><small>-- Dev</small><br>
  <div class='box red'></div><small>-- CR Fix</small><br>
  <div class='box black'></div><small>-- QA Support</small><br>
  <div class='box purple'></div><small>-- Release Support</small><br>
</div>

<script>
  $(document).ready(function() {
      $('.js-example-basic-single').select2();
    });
</script>

</body>
{% endblock %}
