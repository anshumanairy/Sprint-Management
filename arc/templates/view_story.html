<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Story Management</title>
    <script
  			  src="https://code.jquery.com/jquery-3.3.1.js"
  			  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
  			  crossorigin="anonymous"></script>
    <!-- <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet"> -->

    <!-- CSS Files -->
    {% load static %}
      <link rel="stylesheet" type="text/css" href="{% static '/bootstrap.min.css' %}">
      <link rel="stylesheet" type="text/css" href="{% static '/paper-dashboard.css' %}">
      <link rel="stylesheet" type="text/css" href="{% static '/w3.css' %}">

    <style media="screen">
        .scrollable-menu {
        height: auto;
        max-height: 200px;
        overflow-x: hidden;
      }
      body{
        font-family: Montserrat;
      }
      #spr{
        padding-top: 70px;
      }
      input[type="text"]::placeholder,input[type="password"]::placeholder{
        color:lightgrey;
      }
      #back{
        background-color:   #f2f5f2;
      }
      #a{
        background-color: white;
        color:black;
      }
      #f,#h{
        width:550px;
        padding-left: 15px;
      }
      #read{
        background-color: lightgrey;
      }
      #hid2{
        padding-top: 20px;
      }
      #devs{
        padding-top: 10px;
      }
      .example_c {
      color: black;
      background: lightgrey;
      border: 1px solid lightgrey;
      transition: all 0.4s ease 0s;
      }
      .example_c:hover {
      background: #303D39;
      border: 1px solid #303D39;
      transition: all 0.4s ease 0s;
      }
      #hid{
        float: right;
        padding-right: 10px;
      }
      #hid1,#hid3{
        display: inline-block;
      }
      .chosen,#bt1{
        font-size: 10px;
      }

    </style>

  </head>

  <body id="re">
    <div class="w3-sidebar w3-bar-block w3-card w3-animate-left" style="display:none" id="mySidebar">
      <button class="w3-bar-item w3-button w3-large"
      onclick="w3_close()">Close &times;</button>
      <a href="{% url 'product' %}" class="w3-bar-item w3-button">Product Console</a>
      <a href="{% url 'view_story' %}" class="w3-bar-item w3-button">Stories</a>
      <a href="{% url 'allocation' %}" class="w3-bar-item w3-button">Allocation Dashboard</a>
      <a href="{% url 'qaprg' %}" class="w3-bar-item w3-button">Progress</a>
      <a href="{% url 'bandwidth' %}" class="w3-bar-item w3-button">Sprint Bandwidth</a>
      <a href="{% url 'tasks' %}l" class="w3-bar-item w3-button">All Tasks</a>
      <a href="{% url 'login' %}" class="w3-bar-item w3-button"><b>Logout</b></a>
    </div>

    <div id="main">


    <div class="w3-teal" id="hx1">
      <button id="openNav" class="w3-button w3-teal w3-xlarge" onclick="w3_open()">&#9776;</button>
      Story Console
      <div id="hid">
        <div id="hid3">
          <form method='POST'>
            {% csrf_token %}
            <select class="chosen" name="select_project">
                <option>{{ nx }}</option>
              {% for n1 in n %}
                <option>{{ n1.name }}</option>
              {% endfor %}
            </select>
            <button class="btn example_c" type="submit" name="submit_project" id="bt1"><small>Select Project </small></button>
          </form>
        </div>
        <div id="hid1">
          <form method='POST'>
            {% csrf_token %}
            <select class="chosen" name="select_sprint">
              <option>{{ nx1 }}</option>
              {% for product in data1 %}
              <option>{{ product.name }}</option>
                {% endfor %}
            </select>
            <button class="btn example_c" type="submit" name="submit_sprint" id="bt1"><small>VIEW STORIES</small></button>
          </form>
        </div>
      </div>
    </div>

    <script>
    function w3_open() {
      document.getElementById("main").style.marginLeft = "25%";
      document.getElementById("mySidebar").style.width = "25%";
      document.getElementById("mySidebar").style.display = "block";
      document.getElementById("openNav").style.display = 'none';
    }
    function w3_close() {
      document.getElementById("main").style.marginLeft = "0%";
      document.getElementById("mySidebar").style.display = "none";
      document.getElementById("openNav").style.display = "inline-block";
    }
    </script>

  <div id="hid2">

    <div class="container-fluid">
      <div class="col-md-2">
        <button class="btn example_c"  onclick="w4_open()" id="allocate"><small>Add Story Manually</small></button>
      </div>
    </div>

    <div class="container-fluid">
      <div class="col-md-2">
        <button class="btn example_c"  onclick="w6_open()" id="csv"><small>Add Story via CSV</small></button>
      </div>
    </div>

  </div>

<form style="display:none" method="POST" enctype="multipart/form-data" id="h">
  {% csrf_token %}
  <div class="jumbotron">
    <div class="col-sm-20">
      <div class="card card-user" id="back">
        <div class="card-header">
          <h5 class="card-title">Add Story via CSV</h5>
        </div>
        <div class="card-body">

          <div class="row">
            <div class="col-md-6 pr-1">
                <input type="file" name="file1">
            </div>
          </div>

          <button type="submit" name="csv_button" class="btn example_c" id="reg1"><small>Submit</small></button>

          <div class="row">
            <div class="update ml-auto mr-auto">
                <input type="button" class="btn example_c" value="Close" onclick="w6_close()">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<!-- <script type="text/javascript">
    jQuery(document).ready(function($){
      var frm = $('#h');
      frm.submit(function () {
        if (this.id == 'h'){
            $.post({
                type: $('#h').attr('method'),
                data: $('#h').serialize(),
                success: function(data) {
                  $("#re").html(data);
                  $("#h")[0].reset();
                },
            });
          return false;
        }
      });
    });
</script> -->

<div id="m2">

<script>
function w6_open() {
  document.getElementById("m2").style.marginTop = "0%";
  document.getElementById("h").style.display = "block";
  document.getElementById("csv").style.display = 'none';
}
function w6_close() {
  document.getElementById("m2").style.marginTop = "0%";
  document.getElementById("h").style.display = "none";
  document.getElementById("csv").style.display = "inline-block";
}
</script>

<form class="post-form w3-animate-top" style="display:none" method='POST' id="f">
  {% csrf_token %}
  <div class="jumbotron">
    <div class="col-sm-20">
      <div class="card card-user" id="back">
        <div class="card-header">
          <h5 class="card-title">Add Story Manually</h5>
        </div>
        <div class="card-body">
          <form>

            <div class="row">
              <div class="col-md-6 pr-1">
                <div class="form-group">
                  <label>Story Name</label>
                  {{ form.story_name }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 pr-1">
                <div class="form-group">
                  <label>Description Link:</label>
                  {{ form.description }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 pr-1">
                <div class="form-group">
                  <label>Jira ID</label>
                  {{ form.jira }}
                </div>
              </div>
            </div>

            <div class="row">
              <div class="update ml-auto mr-auto">
                <input type="hidden" name="spr1" value="1">
                <input type="submit" name="story_button" class="btn example_c" id="reg1" value="Create Story">
              </div>
            </div>

            <div class="row">
              <div class="update ml-auto mr-auto">
                <button class="btn example_c" onclick="w4_close()" id="story_close"><small>Close</small></button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</form>

<div id="m">

<script>
function w4_open() {
  document.getElementById("m").style.marginTop = "0%";
  document.getElementById("f").style.display = "block";
  document.getElementById("allocate").style.display = 'none';
}
function w4_close() {
  document.getElementById("m").style.marginTop = "0%";
  document.getElementById("f").style.display = "none";
  document.getElementById("allocate").style.display = "inline-block";
}
</script>

<div class="content" id="devs">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table" id="tab2">
              <thead class="text-primary">
                <!-- <th>Check</th> -->
                <th>Story Name</th>
                <th>Jira ID</th>
                <th>Description</th>
                <th>Action</th>
              </thead>
              <tbody>
                {% for d in data %}
                <tr class="w3-animate-top" style="display:none" id="e">
                  <form method="get" id='edit2'>
                    {% csrf_token %}
                    <td><label>Story Name</label>
                    <input type="text" name="s_name" value="" id="a1"></td>
                    <td><label>Description Link</label>
                    <input type="url" name="desc" value="" id="b1"></td>
                    <td><label>Old Jira ID</label>
                    <input type="text" name ="old_jira" value="" id="c1"></td>
                    <td><label>New Jira ID</label>
                    <input type="text" name="new_jira" value="" id="d1"></td>
                    <td>
                      <input class ="btn-xs btn-info" type="submit" value="Submit">
                      <input type="button" class="btn-xs btn-info" onclick="w5_close()" value="Dont Edit">
                    </td>
                  </form>

                  <script type="text/javascript">
                      jQuery(document).ready(function($){
                        var frm = $('#edit2');
                        frm.submit(function () {
                          if (this.id == 'edit2'){
                              $.ajax({
                                  type: $('#edit2').attr('method'),
                                  data: $('#edit2').serialize(),
                                  success: function(data) {
                                    $("#re").html(data);
                                  },
                              });
                            return false;
                          }
                        });
                      });
                  </script>

                </tr>
                <tr>
                  <td>{{ d.story_name }}</td>
                  <td>{{ d.jira }}</td>
                  <td><a href="{{ d.description }}" target="_blank">{{ d.description }}</a></td>
                  <td>
                    <!-- <form method="GET"> -->
                      <input type="button" class="btn example_c" onclick="w5_open({{d.id}})" value="Edit" id="edit">
                    <!-- </form> -->
                    <p></p>
                    <form method="get" id="x{{d.id}}">
                      {% csrf_token %}
                      <input type="hidden" name="delete_story" value="{{ d.id }}">
                      <input type="submit" class="btn example_c" value="Delete" id="delete">
                    </form>
                    <script type="text/javascript">
                        jQuery(document).ready(function($){
                          var frm = $('#x{{d.id}}');
                          frm.submit(function () {
                            if (this.id == 'x{{d.id}}'){
                                $.ajax({
                                    type: $('#x{{d.id}}').attr('method'),
                                    data: $('#x{{d.id}}').serialize(),
                                    success: function(data) {
                                      $("#re").html(data);
                                    },
                                });
                              return false;
                            }
                          });
                        });
                    </script>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <script type="text/javascript">
    jQuery(document).ready(function($){
      var frm = $('#f');
      frm.submit(function () {
        if (this.id == 'f'){
            $.post({
                type: $('#f').attr('method'),
                data: $('#f').serialize(),
                success: function(data) {
                  $("#re").html(data);
                  $("#f")[0].reset();
                },
            });
          return false;
        }
      });
    });
</script> -->

<div id="n">
<script>
function w5_open(e) {
  document.getElementById("n").style.marginTop = "0%";
  document.getElementById("e").style.display = "block";
  document.getElementById("edit").style.display = 'none';
  // console.log(e);
  $(document).ready(function() {
    var d1  = JSON.parse('{{ jd1|escapejs }}');
    var d2  = JSON.parse('{{ jd2|escapejs }}');
    var d3  = JSON.parse('{{ jd3|escapejs }}');
    var d4  = JSON.parse('{{ jd4|escapejs }}');
    var a=""
    var b=""
    var c=""
    for(i in d1){
      if(e==d1[i]){
        a=d2[i];
        b=d3[i];
        c=d4[i];
        break;
      }
    }
    document.getElementById('a1').value = a;
    document.getElementById('b1').value = b;
    document.getElementById('c1').value = c;
    document.getElementById('d1').value = c;
  });
}

function w5_close() {
  document.getElementById("n").style.marginTop = "0%";
  document.getElementById("e").style.display = "none";
  document.getElementById("edit").style.display = "inline-block";
}
</script>

  </body>
</html>
